<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CHC Paint - Warehouse Sale 2026</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Removed EmailJS SDK — emails now handled server-side -->
  <style>
    .line-through { text-decoration: line-through; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in { animation: fadeIn 0.3s ease-out; }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    .shake { animation: shake 0.3s ease-in-out; }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .animate-spin { animation: spin 1s linear infinite; }
  </style>
</head>
<body class="bg-gray-50">
  <div id="app"></div>

  <script>
    // ========================================
    // CONFIGURATION (no secrets in client code)
    // ========================================
    // Email notifications are handled server-side via Nodemailer.
    // Password verification is handled server-side via /api/auth/verify.

    const BRANCH_EMAILS = {
      "Woodbridge": "woodbridge@chcpaint.com",
      "Markham": "markham@chcpaint.com",
      "Ottawa": "ottawa@chcpaint.com",
      "Hamilton": "hamilton@chcpaint.com",
      "Oakville": "oakville@chcpaint.com",
      "St. Catharines": "stcatharines@chcpaint.com"
    };

    let isAuthenticated = sessionStorage.getItem('chc_authenticated') === 'true';

    // ========================================
    // PRODUCT DATA - ALL 428 PRODUCTS
    // ========================================
    const PRODUCTS = {
      "3M": {
        hasCategories: true,
        categories: {
          "Abrasives & Sanding": [
            { sku: "MMM02021", name: "3M Wetordry Abrasive Sheet P1000", previousPrice: "85.99", salePrice: "64.99" },
            { sku: "MMM02022", name: "3M Wetordry Abrasive Sheet P1200", previousPrice: "74.99", salePrice: "64.99" },
            { sku: "MMM02023", name: "3M Wetordry Abrasive Sheet P1500", previousPrice: "74.99", salePrice: "64.99" },
            { sku: "MMM02035", name: "3M Wetordry Abrasive Sheet P800", previousPrice: "85.99", salePrice: "69.99" },
            { sku: "MMM02036", name: "3M Wetordry Abrasive Sheet P600", previousPrice: "85.99", salePrice: "69.99" },
            { sku: "MMM02038", name: "3M Wetordry Abrasive Sheet P400", previousPrice: "85.99", salePrice: "69.99" },
            { sku: "MMM02044", name: "3M Wetordry Abrasive Sheet P2000", previousPrice: "85.99", salePrice: "64.99" },
            { sku: "MMM02045", name: "3M Wetordry Abrasive Sheet P2500", previousPrice: "85.99", salePrice: "64.99" },
            { sku: "MMM02085", name: "3M 6in Trizact Hookit Foam Disc P3000", previousPrice: "180.99", salePrice: "139.99" },
            { sku: "MMM02087", name: "3M 3in Trizact Hookit Foam Disc P3000", previousPrice: "91.99", salePrice: "74.99" },
            { sku: "MMM30662", name: "3M Trizact Hookit Foam Disc P5000 6in", previousPrice: "159.99", salePrice: "109.99" },
            { sku: "MMM30666", name: "3M Hookit Purple Finishing Film Disc 6in P2000", previousPrice: "79.99", salePrice: "64.99" },
            { sku: "MMM31370", name: "3M Cubitron II Hookit Abrasive Disc P40 6in", previousPrice: "95.99", salePrice: "79.99" },
            { sku: "MMM31371", name: "3M Cubitron II Hookit Abrasive Disc P80 6in", previousPrice: "79.99", salePrice: "59.99" },
            { sku: "MMM31372", name: "3M Cubitron II Hookit Abrasive Disc P120 6in", previousPrice: "79.99", salePrice: "59.99" },
            { sku: "MMM31373", name: "3M Cubitron II Hookit Abrasive Disc P150 6in", previousPrice: "79.99", salePrice: "59.99" },
            { sku: "MMM33538", name: "3M Hookit Flexible Foam Abrasive Disc P400 6in", previousPrice: "52.99", salePrice: "39.99" },
            { sku: "MMM33539", name: "3M Hookit Flexible Foam Abrasive Disc P600 6in", previousPrice: "52.99", salePrice: "39.99" },
            { sku: "MMM36170", name: "3M Hookit Blue Disc P40 6in", previousPrice: "58.99", salePrice: "49.99" },
            { sku: "MMM36172", name: "3M Hookit Blue Disc P80 6in", previousPrice: "63.99", salePrice: "49.99" },
            { sku: "MMM36174", name: "3M Hookit Blue Disc P120 6in", previousPrice: "58.99", salePrice: "49.99" },
            { sku: "MMM36176", name: "3M Hookit Blue Disc P180 6in", previousPrice: "58.99", salePrice: "49.99" },
            { sku: "MMM36180", name: "3M Hookit Blue Disc P320 6in", previousPrice: "58.99", salePrice: "49.99" },
          ],
          "Polishing & Compounding": [
            { sku: "MMM05706", name: "3M Perfect-It Foam Compounding Pad", previousPrice: "63.99", salePrice: "29.99" },
            { sku: "MMM05707", name: "3M Perfect-It Foam Polishing Pad", previousPrice: "58.99", salePrice: "35.99" },
            { sku: "MMM05708", name: "3M Perfect-It Ultrafine Foam Polishing Pad", previousPrice: "58.99", salePrice: "39.99" },
            { sku: "MMM06068", name: "3M Perfect-It Ultrafine Machine Polish 946mL", previousPrice: "74.99", salePrice: "69.99" },
            { sku: "MMM06094", name: "3M Perfect-It Machine Polish", previousPrice: "85.99", salePrice: "69.99" },
            { sku: "MMM33279", name: "3M Perfect-It Low Linting Wool Pad", previousPrice: "79.99", salePrice: "59.99" },
            { sku: "MMM36060", name: "3M Perfect-It EX Rubbing Compound Qt", previousPrice: "74.99", salePrice: "59.99" },
          ],
          "Body Fillers & Repair": [
            { sku: "MMM01131", name: "3M Platinum Plus Body Filler Ga", previousPrice: "71.99", salePrice: "69.99", promo: "Buy 3 Gallons Get 1 Gallon Free" },
            { sku: "MMM04240", name: "3M Semi-Rigid Plastic Repair 200mL", previousPrice: "79.99", salePrice: "59.99" },
            { sku: "MMM04247", name: "3M Super Fast Plastic Repair 200mL", previousPrice: "90.99", salePrice: "69.99" },
            { sku: "MMM04248", name: "3M Super Fast Repair Adhesive 200mL", previousPrice: "100.99", salePrice: "74.99" },
            { sku: "MMM05887", name: "3M EZ Sand Flexible Parts Repair Adhesive", previousPrice: "110.99", salePrice: "79.99" },
            { sku: "MMM05860", name: "3M Dry Guide Coat Cartridge", previousPrice: "53.99", salePrice: "44.99", promo: "Buy 2 Cases Get 1 Free" },
            { sku: "MMM05861", name: "3M Dry Guide Coat Applicator Kit", previousPrice: "79.99", salePrice: "64.99" },
            { sku: "MMM20382", name: "3M Disposable Paper Mixing Board", previousPrice: "37.99", salePrice: "29.99" },
          ],
          "Adhesives & Seam Sealers": [
            { sku: "MMM07333", name: "3M Impact Resistant Structural Adhesive 200mL", previousPrice: "160.99", salePrice: "99.99" },
            { sku: "MMM08115", name: "3M Automix Panel Bonding Adhesive 200mL", previousPrice: "101.99", salePrice: "79.99" },
            { sku: "MMM08194", name: "3M Static Mix Nozzles", previousPrice: "148.99", salePrice: "109.99" },
            { sku: "MMM08308", name: "3M Heavy-Bodied Seam Sealer 200mL", previousPrice: "74.99", salePrice: "59.99" },
            { sku: "MMM08323", name: "3M Factory Match Seam Sealer 200mL", previousPrice: "76.99", salePrice: "49.99" },
            { sku: "MMM08522", name: "3M OEM Match Epoxy Seam Sealer Beige", previousPrice: "97.99", salePrice: "57.99" },
            { sku: "MMM08524", name: "3M OEM Match Epoxy Seam Sealer White", previousPrice: "97.99", salePrice: "57.99" },
            { sku: "MMM08526", name: "3M OEM Match Epoxy Seam Sealer Gray", previousPrice: "97.99", salePrice: "57.99" },
            { sku: "MMM08528", name: "3M OEM Match Epoxy Seam Sealer Black", previousPrice: "97.99", salePrice: "57.99" },
            { sku: "MMM08852", name: "3M Cavity Wax Plus 511g", previousPrice: "42.99", salePrice: "42.99", promo: "Buy 2 Cases Get 1 Free" },
            { sku: "MMM06382", name: "3M Two Way Acrylic Plus Tape 1/2in", previousPrice: "73.99", salePrice: "49.99" },
            { sku: "MMM06383", name: "3M Two Way Acrylic Plus Tape 7/8in", previousPrice: "107.99", salePrice: "69.99" },
            { sku: "MMM06386", name: "3M Two Way Acrylic Plus Tape 1/4in", previousPrice: "61.99", salePrice: "29.99" },
          ],
          "Masking & Surface Protection": [
            { sku: "MMM06349", name: "3M Trim & Lift Masking Tape", previousPrice: "63.99", salePrice: "39.99" },
            { sku: "MMM06652", name: "3M Yellow Masking Tape 18mm", previousPrice: "159.99", salePrice: "119.99" },
            { sku: "MMM06654", name: "3M Yellow Masking Tape 36mm", previousPrice: "159.99", salePrice: "119.99" },
            { sku: "MMM06656", name: "3M Yellow Masking Tape 48mm", previousPrice: "191.99", salePrice: "129.99" },
            { sku: "MMM06718", name: "3M Scotchblok Masking Paper", previousPrice: "74.99", salePrice: "64.99" },
            { sku: "MMM06724", name: "3M Plastic Sheeting 16x350ft", previousPrice: "58.99", salePrice: "33.99" },
            { sku: "MMM26334", name: "3M Scotch Green Masking Tape 3/4in", previousPrice: "244.99", salePrice: "169.99" },
            { sku: "MMM26338", name: "3M Scotch Green Masking Tape 1 1/2in", previousPrice: "138.99", salePrice: "99.99" },
            { sku: "MMM36852", name: "3M Dirt Trap Protection Material 28in", previousPrice: "668.99", salePrice: "499.99" },
            { sku: "MMM05916", name: "3M Welding and Spark Deflection Paper", previousPrice: "244.99", salePrice: "149.99" },
            { sku: "MMM05917", name: "3M Weld-Thru Coating II", previousPrice: "47.99", salePrice: "39.99" },
            { sku: "MMM07847", name: "3M Scotch-Brite Red Durable Flex Pads", previousPrice: "37.99", salePrice: "37.99", promo: "Buy 2 Cases Get 1 Free" },
            { sku: "MMM07848", name: "3M Scotch-Brite Grey Durable Flex Pads", previousPrice: "37.99", salePrice: "37.99", promo: "Buy 2 Cases Get 1 Free" },
          ],
          "Spray Guns & PPS Systems": [
            { sku: "MMM26000", name: "3M PPS Series 2.0 Standard", previousPrice: "169.99", salePrice: "119.99" },
            { sku: "MMM26024", name: "3M PPS Spray Cup Large", previousPrice: "175.99", salePrice: "124.99" },
            { sku: "MMM26112", name: "3M PPS 2.0 Kit", previousPrice: "175.99", salePrice: "109.99" },
            { sku: "MMM26114", name: "3M PPS 2.0 Mini Kit", previousPrice: "159.99", salePrice: "99.99" },
            { sku: "MMM26163", name: "3M PPS 2.0 Vented Cups Standard", previousPrice: "201.99", salePrice: "69.99" },
            { sku: "MMM26164", name: "3M PPS 2.0 Vented Large Cups", previousPrice: "201.99", salePrice: "89.99" },
            { sku: "MMM26301", name: "3M PPS 2.0 Medium Lids & Liners", previousPrice: "169.99", salePrice: "119.99" },
            { sku: "MMM26689", name: "3M High Power Spray Gun Cleaner", previousPrice: "16.99", salePrice: "16.99", promo: "Buy 2 Cases Get 1 Free" },
            { sku: "MMM26832", name: "3M Performance Spray Gun", previousPrice: "488.99", salePrice: "399.99" },
            { sku: "MMM26712", name: "3M HVLP Atomizing Head Refill Kit 1.2", previousPrice: "53.99", salePrice: "49.99" },
            { sku: "MMM26713", name: "3M HVLP Atomizing Head Refill Kit 1.3", previousPrice: "53.99", salePrice: "49.99" },
            { sku: "MMM26714", name: "3M HVLP Atomizing Head Refill Kit 1.4", previousPrice: "53.99", salePrice: "49.99" },
          ],
        }
      },
      "SEM": {
        hasCategories: true,
        categories: {
          "Seam Sealers": [
            { sku: "SEM29362", name: "SEM 1K SEAM SEALER - WHITE", previousPrice: "30.99", salePrice: "27.99" },
            { sku: "SEM29372", name: "SEM 1K SEAM SEALER - GRAY", previousPrice: "30.99", salePrice: "27.99" },
            { sku: "SEM29382", name: "SEM 1K SEAM SEALER - BEIGE", previousPrice: "30.99", salePrice: "27.99" },
            { sku: "SEM29392", name: "SEM 1K SEAM SEALER - BLACK", previousPrice: "30.99", salePrice: "27.99" },
            { sku: "SEM29462", name: "SEM 2-IN-1 SEAM SEALER - WHITE", previousPrice: "34.99", salePrice: "29.99" },
            { sku: "SEM29472", name: "SEM 2-IN-1 SEAM SEALER - GRAY", previousPrice: "34.99", salePrice: "29.99" },
            { sku: "SEM29482", name: "SEM 2-IN-1 SEAM SEALER - BEIGE", previousPrice: "34.99", salePrice: "29.99" },
            { sku: "SEM29492", name: "SEM 2-IN-1 SEAM SEALER - BLACK", previousPrice: "34.99", salePrice: "29.99" },
          ],
          "Primers & Coatings": [
            { sku: "SEM39143", name: "SEM TRIM BLACK", previousPrice: "24.99", salePrice: "19.99" },
            { sku: "SEM39144-LV", name: "SEM LOW VOC TRIM BLACK", previousPrice: "87.99", salePrice: "69.99" },
            { sku: "SEM39673", name: "SEM SELF ETCHING PRIMER - BLACK", previousPrice: "37.99", salePrice: "29.99" },
            { sku: "SEM39683", name: "SEM SELF ETCHING PRIMER - GRAY", previousPrice: "37.99", salePrice: "29.99" },
            { sku: "SEM39863", name: "SEM PLASTIC ADHESION PROMOTER", previousPrice: "45.99", salePrice: "39.99" },
            { sku: "SEM40773", name: "SEM ZINCWELD", previousPrice: "39.99", salePrice: "34.99" },
            { sku: "SEM62213", name: "SEM EZ COAT - BLACK", previousPrice: "30.99", salePrice: "24.99" },
            { sku: "SEM62243", name: "SEM EZ COAT - GRAY", previousPrice: "30.99", salePrice: "24.99" },
          ],
          "Body Fillers & Glazes": [
            { sku: "SEM40561", name: "SEM Powder Pro Ultra Lightweight Body Filler", previousPrice: "99.99", salePrice: "79.99" },
            { sku: "SEM39592", name: "SEM METAL BITE FINISHING GLAZE", previousPrice: "66.99", salePrice: "54.99" },
            { sku: "SEM40482", name: "SEM BUMPER BITE FLEXIBLE GLAZE", previousPrice: "55.99", salePrice: "44.99" },
          ],
          "Bed Liners & Protective Coatings": [
            { sku: "SEM56650", name: "SEM GLADIATOR XC BLACK KIT", previousPrice: "243.99", salePrice: "199.99" },
            { sku: "SEM56670", name: "SEM GLADIATOR XC TINTABLE KIT", previousPrice: "243.99", salePrice: "199.99" },
          ],
          "Abrasives": [
            { sku: "SA6080", name: "SEM 6\" Grip Multihole 80, 50 Discs/Box", previousPrice: "67.99", salePrice: "59.99" },
            { sku: "SA6120", name: "SEM 6\" Grip Multihole 120, 50 Discs/Box", previousPrice: "69.99", salePrice: "49.99" },
            { sku: "SA6180", name: "SEM 6\" Grip Multihole 180, 50 Discs/Box", previousPrice: "69.99", salePrice: "49.99" },
            { sku: "SA6240", name: "SEM 6\" Grip Multihole 240, 50 Discs/Box", previousPrice: "69.99", salePrice: "49.99" },
            { sku: "SA6320", name: "SEM 6\" Grip Multihole 320, 50 Discs/Box", previousPrice: "69.99", salePrice: "49.99" },
            { sku: "SA6400", name: "SEM 6\" Grip Multihole 400, 50 Discs/Box", previousPrice: "69.99", salePrice: "49.99" },
          ],
          "Aerosols & Specialty": [
            { sku: "SEM61993", name: "SEM CUSTOM FILL AEROSOL BLANK", previousPrice: "60.00", salePrice: "24.99" },
          ],
        }
      },
      "PPG": {
        hasCategories: true,
        categories: {
          "Clearcoats": [
            { sku: "EC520", name: "EHP High Production Clearcoat Ga", previousPrice: "816.20", salePrice: "408.10" },
            { sku: "EC530", name: "EHP Performance Clearcoat Ga", previousPrice: "816.20", salePrice: "408.10" },
            { sku: "EC550", name: "EHP Ultra Gloss Clearcoat Ga", previousPrice: "816.20", salePrice: "408.10" },
            { sku: "EC5515", name: "EHP Low VOC Matte Clearcoat Qt", previousPrice: "424.82", salePrice: "212.41" },
            { sku: "EC800", name: "EHP Ultra Fast 2.1 Clearcoat Ga", previousPrice: "772.22", salePrice: "386.11" },
            { sku: "JC7200/01", name: "Shop-Line 2.1 VOC HS European Clearcoat Ga", previousPrice: "225.48", salePrice: "112.74" },
            { sku: "JC830", name: "Shop-Line 2.1 VOC Production Clear Ga", previousPrice: "210.58", salePrice: "105.29" },
          ],
          "Primers & Sealers": [
            { sku: "ECP35", name: "EHP High Production Surfacer 2.1VOC Ga", previousPrice: "694.41", salePrice: "347.20" },
            { sku: "ECS21", name: "EHP A-Chromatic 2.1VOC Sealer White Ga", previousPrice: "683.88", salePrice: "341.94" },
            { sku: "ECS25", name: "EHP A-Chromatic 2.1VOC Sealer Gray Ga", previousPrice: "683.88", salePrice: "341.94" },
            { sku: "ECS27", name: "EHP A-Chromatic 2.1VOC Sealer Black Ga", previousPrice: "683.88", salePrice: "341.94" },
            { sku: "JP355", name: "Shop-Line 2.1 VOC Gray Primer Ga", previousPrice: "221.84", salePrice: "110.92" },
            { sku: "JP365", name: "Shop-Line Urethane Sealer Gray Ga", previousPrice: "299.62", salePrice: "149.81" },
            { sku: "JP390", name: "Shop-Line Epoxy Primer Gray Qt", previousPrice: "69.98", salePrice: "34.99" },
          ],
          "Hardeners & Reducers": [
            { sku: "ECH5075", name: "EHP Standard Clearcoat Hardener Qt", previousPrice: "236.78", salePrice: "118.39" },
            { sku: "JR554", name: "Shop-Line Low VOC Fast Reducer Ga", previousPrice: "121.64", salePrice: "60.82" },
            { sku: "JR555", name: "Shop-Line Low VOC Medium Reducer Ga", previousPrice: "166.22", salePrice: "83.11" },
          ],
          "Specialty Products": [
            { sku: "T4900", name: "EHP OneVisit Modifier ST 2L", previousPrice: "1509.78", salePrice: "754.89" },
            { sku: "T4910", name: "EHP OneVisit Modifier HD 2L", previousPrice: "1509.78", salePrice: "754.89" },
          ],
          "Shop Supplies": [
            { sku: "AL84-0314", name: "PPG Single Edge Razor Blades 100/pk", previousPrice: "9.49", salePrice: "4.99" },
            { sku: "BLUEPSL", name: "PPG Blue Paint Suit Large", previousPrice: "70.20", salePrice: "49.99" },
            { sku: "BLUEPSM", name: "PPG Blue Paint Suit Medium", previousPrice: "70.20", salePrice: "49.99" },
            { sku: "DOX112", name: "PPG Disposable Mixing Sticks (500/bx)", previousPrice: "79.99", salePrice: "54.99" },
            { sku: "DOX113", name: "PPG Paint Filters", previousPrice: "28.85", salePrice: "19.99" },
            { sku: "DOX251", name: "PPG 32Oz Mixing Cups", previousPrice: "69.69", salePrice: "49.99" },
            { sku: "DOX273", name: "PPG 85oz Mixing Cups 50/box", previousPrice: "70.28", salePrice: "49.99" },
            { sku: "VRW100", name: "PPG Crash Wrap", previousPrice: "123.02", salePrice: "89.99" },
            { sku: "WMP2412", name: "PPG White Masking Paper 12 x 750", previousPrice: "111.51", salePrice: "79.99" },
            { sku: "WMP2418", name: "PPG White Masking Paper 18 x 750", previousPrice: "111.51", salePrice: "79.99" },
          ],
        }
      },
      "Norton": {
        hasCategories: true,
        categories: {
          "Masking Paper": [
            { sku: "NOR00402", name: "Masking Paper 6\" X 750 white", previousPrice: "101.99", salePrice: "69.99" },
            { sku: "NOR00403", name: "Norton 12in Masking Paper", previousPrice: "101.99", salePrice: "69.99" },
            { sku: "NOR00404", name: "Norton 18in Masking Paper", previousPrice: "101.99", salePrice: "69.99" },
            { sku: "NOR00407", name: "Norton 36\" Masking Paper", previousPrice: "102.99", salePrice: "69.99" },
          ],
          "Adhesives & Structural Bonding": [
            { sku: "NOR04615", name: "Norton SpeedGrip Urethane Structural Adhesive 1min", previousPrice: "90.99", salePrice: "54.99" },
            { sku: "NOR04616", name: "Norton SpeedGrip Urethane Structural Adhesive 5min", previousPrice: "90.99", salePrice: "54.99" },
            { sku: "NOR04647", name: "Norton SpeedGrip Urethane Structural Adhesive 45sec", previousPrice: "90.99", salePrice: "54.99" },
          ],
          "Seam Sealers": [
            { sku: "NOR06398", name: "Norton Bare Metal Epoxy Seam Sealer", previousPrice: "70.99", salePrice: "54.99" },
            { sku: "NOR06402", name: "Norton Control Flow Epoxy Seam Sealer", previousPrice: "67.99", salePrice: "49.99" },
            { sku: "NOR06412", name: "Norton Epoxy Repair Adhesive Filler", previousPrice: "83.99", salePrice: "59.99" },
            { sku: "NOR97120", name: "Norton Epoxy Seam Sealer", previousPrice: "69.99", salePrice: "49.99" },
          ],
          "Scuff Pads": [
            { sku: "NOR06166", name: "Norton Maroon Thin Pads", previousPrice: "33.99", salePrice: "19.99" },
            { sku: "NOR06167", name: "Norton Grey Thin Scuff Pads", previousPrice: "33.99", salePrice: "19.99" },
            { sku: "NOR34771", name: "Norton Bear-Tex 6in Grey Scuff Disc", previousPrice: "40.99", salePrice: "27.99" },
            { sku: "NOR34770", name: "Norton Bear-Tex 6in Maroon Scuff Disc", previousPrice: "40.99", salePrice: "27.99" },
          ],
          "Sanding Discs": [
            { sku: "NOR06225", name: "Norton 6in Gold P240", previousPrice: "22.99", salePrice: "19.99" },
            { sku: "NOR06226", name: "Norton 6in Gold P800", previousPrice: "22.99", salePrice: "19.99" },
            { sku: "NOR06227", name: "Norton 6in Gold P600", previousPrice: "22.99", salePrice: "19.99" },
            { sku: "NOR06230", name: "Norton 6in Gold P320", previousPrice: "22.99", salePrice: "19.99" },
          ],
          "Specialty Products": [
            { sku: "NOR42082", name: "Norton LiquidIce Clean-Up Detailer Spray", previousPrice: "35.99", salePrice: "24.99" },
          ],
        }
      },
      "Equipment": {
        hasCategories: false,
        products: [
          { sku: "MSX134", name: "MAXXAIR S Series AC R134", previousPrice: "10289.99", salePrice: "8574.99" },
          { sku: "MSX3030", name: "MAXXAIR S Series AC R134A/R1234", previousPrice: "16019.99", salePrice: "13349.99" },
          { sku: "MSX1234", name: "MAXXAIR S SERIES R1234", previousPrice: "13649.99", salePrice: "11374.99" },
          { sku: "MSX390100", name: "MAXXAIR SpotGunJr Starter Kit", previousPrice: "236.89", salePrice: "205.99" },
          { sku: "MSX390200", name: "MAXXAIR SpotGunJr Master Kit", previousPrice: "298.99", salePrice: "259.99" },
          { sku: "MSX490100", name: "MAXXAIR Starter Kit", previousPrice: "201.24", salePrice: "174.99" },
          { sku: "MSX490200", name: "MAXXAIR Master Kit", previousPrice: "246.09", salePrice: "213.99" },
          { sku: "MSX488046PB", name: "MAXXAIR PAG 46 Oil", previousPrice: "21.72", salePrice: "18.89" },
          { sku: "MSX488046PBD", name: "MAXXAIR PAG 46 Oil with AC ExtenDye", previousPrice: "15.32", salePrice: "13.32" },
          { sku: "MSXFXP2", name: "MAXXAIR FX Series Kits", previousPrice: "1228.23", salePrice: "1068.03" },
          { sku: "RBNLD3", name: "RobinAir LD3 Refrigerant Leak Detector Economy", previousPrice: "536.73", salePrice: "479.22" },
          { sku: "RBNLD5", name: "RobinAir LD5 Refrigerant Leak Detector Select", previousPrice: "742.29", salePrice: "662.76" },
          { sku: "RBNLD7", name: "RobinAir LD7 Refrigerant Leak Detector Premium", previousPrice: "799.41", salePrice: "713.76" },
          { sku: "RBN34288NI", name: "RobinAir Basic 134a Refrigerant", previousPrice: "7674.84", salePrice: "6852.54" },
          { sku: "RBN34788NI", name: "RobinAir Multi-Vehicle 134a Refrigerant", previousPrice: "9273.75", salePrice: "8280.13" },
          { sku: "RBNAC1234-4", name: "RobinAir Basic 1234yf Refrigerant", previousPrice: "12365.07", salePrice: "11040.24" },
          { sku: "BSHDAS3000-3", name: "Bosch DAS3000-3 ADAS System", previousPrice: "57622.72", salePrice: "42683.50" },
          { sku: "STG030420", name: "StrongArm 3-1/2 Ton Service Jack w 4-Ton Stand", previousPrice: "712.80", salePrice: "636.43" },
        ]
      },
      "Henkel": {
        hasCategories: false,
        products: [
          { sku: "HEN1305486", name: "Henkel Teroson Flatstream Nozzles", previousPrice: "20.99", salePrice: "14.99" },
          { sku: "HEN1470999", name: "Henkel Teroson Widestream Nozzle 10pk", previousPrice: "20.99", salePrice: "14.99" },
          { sku: "HEN2264448", name: "Henkel Loctite 4070 Universal Adhesive Kit", previousPrice: "34.99", salePrice: "24.99" },
          { sku: "HEN2399541", name: "Henkel Teroson Door Edge Nozzle", previousPrice: "20.99", salePrice: "14.99" },
          { sku: "HEN2399908", name: "Henkel Teroson T2 Flat Nozzles", previousPrice: "20.99", salePrice: "14.99" },
          { sku: "HEN2469715", name: "Henkel Teroson WT S3000 Stonechip Protection", previousPrice: "63.99", salePrice: "39.99" },
          { sku: "HEN2568797", name: "Henkel Teroson MS 222 Anti-Flutter Material", previousPrice: "44.99", salePrice: "29.99" },
          { sku: "HEN2568817", name: "Henkel Teroson MS 9120 SF - White", previousPrice: "37.99", salePrice: "24.99" },
          { sku: "HEN2568818", name: "Henkel Teroson MS 9320 SF - Grey", previousPrice: "37.99", salePrice: "24.99" },
          { sku: "HEN2816502", name: "Henkel Teroson EP 5055 SB Panel Bond Adhesive", previousPrice: "91.99", salePrice: "49.99" },
          { sku: "HEN2820041", name: "Henkel Teroson MS 9320 SF - Black", previousPrice: "37.99", salePrice: "24.99" },
          { sku: "HEN1434516", name: "Henkel Loctite Replacement Nozzles", previousPrice: "7.99", salePrice: "5.99" },
          { sku: "HEN1585815", name: "Henkel Teroson ET UBC Gun", previousPrice: "60.99", salePrice: "54.99" },
        ]
      },
      "Q1": {
        hasCategories: false,
        products: [
          { sku: "CPM118", name: "Q1 Car Plus Masking Tape 18mm (3/4\")", previousPrice: "75.00", salePrice: "65.00" },
          { sku: "CPM136.55", name: "Q1 Car Plus Masking Tape 36mm (1 1/2\")", previousPrice: "75.00", salePrice: "65.00" },
        ]
      },
      "Rexall": {
        hasCategories: false,
        products: [
          { sku: "CHC590248-5", name: "Premium Solvent Cleaner", previousPrice: "75.00", salePrice: "49.99" },
          { sku: "CHC590266-5", name: "Professional Solvent Cleaner", previousPrice: "59.99", salePrice: "39.99" },
          { sku: "CHC590269-5", name: "Wax and Grease Remover 5Ga", previousPrice: "135.99", salePrice: "79.99" },
          { sku: "CHC590353-5", name: "Final Wash 5Ga", previousPrice: "99.99", salePrice: "79.99" },
          { sku: "MTN0002", name: "Montana Stone Shield 400ml", previousPrice: "13.49", salePrice: "9.99" },
          { sku: "MTN0901", name: "Montana Matte Black 400ml", previousPrice: "12.49", salePrice: "7.99" },
          { sku: "MTN0903", name: "Montana Satin Black 400ml", previousPrice: "12.49", salePrice: "7.99" },
          { sku: "MTN0908", name: "Montana Gloss Acrylic 400ml", previousPrice: "15.49", salePrice: "11.99" },
          { sku: "MTN9010", name: "Montana Gloss White 400ml", previousPrice: "12.49", salePrice: "7.99" },
          { sku: "MTN9011", name: "Montana Gloss Black 400ml", previousPrice: "12.49", salePrice: "7.99" },
        ]
      },
      "Tork": {
        hasCategories: false,
        products: [
          { sku: "SCA121202", name: "8.25'x 600' M-Torq 6/pkg", previousPrice: "65.00", salePrice: "49.99" },
          { sku: "SCA192480", name: "Specialist Cloth Top Pack", previousPrice: "159.99", salePrice: "119.99" },
        ]
      },
      "Wipeco": {
        hasCategories: false,
        products: [
          { sku: "DN106-L", name: "WIPECO 6 Mil Nitrile Gloves L 100/BX", previousPrice: "15.00", salePrice: "8.99" },
          { sku: "DN106-M", name: "WIPECO 6 Mil Nitrile Gloves M 100/Bx", previousPrice: "15.00", salePrice: "8.99" },
          { sku: "DN106-XL", name: "WIPECO 6 Mil Nitrile Gloves XL 100/Bx", previousPrice: "15.00", salePrice: "8.99" },
          { sku: "DN850BKEC-L", name: "WIPECO 8 Mil Nitrile Gloves L 50/Bx", previousPrice: "15.00", salePrice: "6.99" },
          { sku: "DN850BKEC-M", name: "WIPECO 8 Mil Nitrile Gloves M 50/Bx", previousPrice: "15.00", salePrice: "6.99" },
          { sku: "DN850BKEC-XL", name: "WIPECO 8 Mil Nitrile Gloves XL 50/Bx", previousPrice: "15.00", salePrice: "6.99" },
        ]
      },
    };

    const BRANDS = ["3M", "SEM", "PPG", "Norton", "Equipment", "Henkel", "Q1", "Rexall", "Tork", "Wipeco"];
    const BRANCHES = ["Woodbridge", "Markham", "Ottawa", "Hamilton", "Oakville", "St. Catharines"];
    const PRODUCT_COUNTS = { "3M": 184, "Equipment": 18, "Henkel": 13, "Norton": 20, "PPG": 29, "Q1": 2, "Rexall": 10, "SEM": 28, "Tork": 2, "Wipeco": 6 };

    // ========================================
    // APPLICATION STATE
    // ========================================
    let state = {
      activeBrand: "3M",
      activeCategory: null,
      searchQuery: "",
      cart: [],
      isCartOpen: false,
      isCheckoutOpen: false,
      orderSubmitted: false,
      isSubmitting: false,
      isAuthenticating: false,
      shopName: "",
      contactEmail: "",
      branch: "",
      toast: null,
      passwordError: false,
      authErrorMessage: "",
      lastOrderId: null
    };

    // ========================================
    // UTILITY FUNCTIONS
    // ========================================
    function formatPrice(price) {
      return parseFloat(price).toFixed(2);
    }

    function getDiscount(prev, sale) {
      const p = parseFloat(prev);
      const s = parseFloat(sale);
      if (p <= 0) return 0;
      return Math.round((p - s) / p * 100);
    }

    function getCartTotal() {
      return state.cart.reduce((sum, item) => sum + parseFloat(item.salePrice) * item.quantity, 0);
    }

    function getCartCount() {
      return state.cart.reduce((sum, item) => sum + item.quantity, 0);
    }

    function getFilteredProducts() {
      const brandData = PRODUCTS[state.activeBrand];
      if (!brandData) return { hasCategories: false, products: [] };
      
      const q = state.searchQuery.toLowerCase();
      
      if (brandData.hasCategories) {
        const filteredCategories = {};
        Object.entries(brandData.categories).forEach(([category, products]) => {
          const filtered = q 
            ? products.filter(p => p.sku.toLowerCase().includes(q) || p.name.toLowerCase().includes(q))
            : products;
          if (filtered.length > 0) {
            filteredCategories[category] = filtered;
          }
        });
        return { hasCategories: true, categories: filteredCategories };
      } else {
        const products = brandData.products || [];
        const filtered = q 
          ? products.filter(p => p.sku.toLowerCase().includes(q) || p.name.toLowerCase().includes(q))
          : products;
        return { hasCategories: false, products: filtered };
      }
    }

    function getTotalFilteredCount() {
      const data = getFilteredProducts();
      if (data.hasCategories) {
        let count = 0;
        Object.values(data.categories).forEach(products => count += products.length);
        return count;
      }
      return data.products.length;
    }

    function generateOrderId() {
      return 'ORD-' + Date.now().toString(36).toUpperCase();
    }

    function formatOrderItems() {
      return state.cart.map(item => 
        `${item.sku} - ${item.name} x${item.quantity} @ $${formatPrice(item.salePrice)} = $${formatPrice(parseFloat(item.salePrice) * item.quantity)}`
      ).join('\n');
    }

    // ========================================
    // ORDER SUBMISSION (server handles email + database)
    // ========================================
    async function submitOrderToBackend() {
      const response = await fetch('/api/orders', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          shopName: state.shopName,
          email: state.contactEmail,
          branch: state.branch,
          items: state.cart,
          total: getCartTotal()
        })
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || 'Failed to submit order');
      }

      return await response.json();
    }

    // ========================================
    // PASSWORD CHECK (server-side verification)
    // ========================================
    async function checkPassword() {
      const input = document.getElementById('passwordInput');
      const password = input ? input.value : '';

      if (!password) {
        state.passwordError = true;
        state.authErrorMessage = 'Please enter a password.';
        render();
        return;
      }

      state.isAuthenticating = true;
      state.passwordError = false;
      state.authErrorMessage = '';
      render();

      try {
        const response = await fetch('/api/auth/verify', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ password })
        });

        const result = await response.json();

        if (response.ok && result.success) {
          isAuthenticated = true;
          sessionStorage.setItem('chc_authenticated', 'true');
          state.passwordError = false;
          state.isAuthenticating = false;
          render();
        } else {
          state.passwordError = true;
          state.isAuthenticating = false;
          state.authErrorMessage = result.error || 'Incorrect password. Please try again.';
          render();
          setTimeout(() => {
            const form = document.getElementById('loginForm');
            if (form) form.classList.add('shake');
          }, 10);
        }
      } catch (error) {
        console.error('Auth error:', error);
        state.passwordError = true;
        state.isAuthenticating = false;
        state.authErrorMessage = 'Connection error. Please try again.';
        render();
      }
    }

    function handlePasswordKeypress(e) {
      if (e.key === 'Enter') {
        checkPassword();
      }
    }

    // ========================================
    // CART & UI ACTIONS
    // ========================================
    function setBrand(brand) {
      state.activeBrand = brand;
      state.activeCategory = null;
      state.searchQuery = "";
      render();
    }

    function setSearch(query) {
      state.searchQuery = query;
      render();
    }

    function addToCart(product) {
      const existing = state.cart.find(item => item.sku === product.sku);
      if (existing) {
        existing.quantity++;
      } else {
        state.cart.push({ ...product, quantity: 1 });
      }
      showToast(`Added ${product.sku} to cart`);
      render();
    }

    function updateQuantity(sku, delta) {
      const item = state.cart.find(i => i.sku === sku);
      if (item) {
        item.quantity += delta;
        if (item.quantity <= 0) {
          state.cart = state.cart.filter(i => i.sku !== sku);
        }
      }
      render();
    }

    function removeFromCart(sku) {
      state.cart = state.cart.filter(i => i.sku !== sku);
      render();
    }

    function openCart() {
      state.isCartOpen = true;
      render();
    }

    function closeCart() {
      state.isCartOpen = false;
      render();
    }

    function openCheckout() {
      state.isCheckoutOpen = true;
      render();
    }

    function closeCheckout() {
      state.isCheckoutOpen = false;
      render();
    }

    async function submitOrder() {
      if (!state.shopName || !state.contactEmail || !state.branch) {
        showToast("Please fill in all fields");
        return;
      }

      state.isSubmitting = true;
      render();

      try {
        const result = await submitOrderToBackend();
        state.lastOrderId = result.orderId;
        state.isSubmitting = false;
        state.orderSubmitted = true;
        state.isCheckoutOpen = false;
        state.isCartOpen = false;
        render();
      } catch (error) {
        state.isSubmitting = false;
        showToast(error.message || "Failed to submit order. Please try again.");
        render();
      }
    }

    function resetOrder() {
      state.orderSubmitted = false;
      state.cart = [];
      state.shopName = "";
      state.contactEmail = "";
      state.branch = "";
      state.lastOrderId = null;
      render();
    }

    function showToast(message) {
      state.toast = message;
      render();
      setTimeout(() => {
        state.toast = null;
        render();
      }, 2500);
    }

    function scrollToCategory(categoryId) {
      const element = document.getElementById(categoryId);
      if (element) {
        element.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }

    // ========================================
    // RENDER FUNCTIONS
    // ========================================
    function render() {
      const app = document.getElementById('app');
      
      if (!isAuthenticated) {
        app.innerHTML = renderLoginPage();
        setTimeout(() => {
          const input = document.getElementById('passwordInput');
          if (input) input.focus();
        }, 100);
        return;
      }
      
      if (state.orderSubmitted) {
        app.innerHTML = renderOrderSuccess();
        return;
      }
      
      app.innerHTML = `
        ${renderHeader()}
        ${renderMain()}
        ${state.isCartOpen ? renderCartSidebar() : ''}
        ${state.isCheckoutOpen ? renderCheckoutModal() : ''}
        ${state.toast ? renderToast() : ''}
      `;
      
      attachEventListeners();
    }

    function renderLoginPage() {
      return `
        <div class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-4">
          <div class="w-full max-w-md">
            <div class="text-center mb-8">
              <div class="inline-flex items-center justify-center w-20 h-20 bg-orange-500 rounded-2xl shadow-lg mb-6">
                <i class="fas fa-box text-white text-3xl"></i>
              </div>
              <h1 class="text-3xl font-bold text-white mb-2">CHC Paint</h1>
              <p class="text-slate-400">Warehouse Sale 2026</p>
            </div>
            
            <div id="loginForm" class="bg-white rounded-2xl shadow-2xl p-8 ${state.passwordError ? 'shake' : ''}">
              <div class="text-center mb-6">
                <div class="inline-flex items-center justify-center w-12 h-12 bg-slate-100 rounded-full mb-4">
                  <i class="fas fa-lock text-slate-600 text-xl"></i>
                </div>
                <h2 class="text-xl font-bold text-slate-900">Customer Access</h2>
                <p class="text-slate-500 text-sm mt-1">Enter your password to view the catalog</p>
              </div>
              
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-2">Password</label>
                  <div class="relative">
                    <input 
                      type="password" 
                      id="passwordInput" 
                      placeholder="Enter customer password"
                      onkeypress="handlePasswordKeypress(event)"
                      class="w-full px-4 py-3 border ${state.passwordError ? 'border-red-300 bg-red-50' : 'border-slate-200'} rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none transition-colors"
                    >
                    <i class="fas fa-key absolute right-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                  </div>
                  ${state.passwordError ? `
                    <p class="mt-2 text-sm text-red-600 flex items-center gap-1">
                      <i class="fas fa-exclamation-circle"></i>
                      ${state.authErrorMessage || 'Incorrect password. Please try again.'}
                    </p>
                  ` : ''}
                </div>
                
                <button
                  onclick="checkPassword()"
                  class="w-full bg-orange-500 hover:bg-orange-600 text-white py-3 rounded-lg font-semibold transition-colors flex items-center justify-center gap-2"
                  ${state.isAuthenticating ? 'disabled' : ''}
                >
                  ${state.isAuthenticating ? `
                    <i class="fas fa-spinner animate-spin"></i>
                    <span>Verifying...</span>
                  ` : `
                    <span>Access Catalog</span>
                    <i class="fas fa-arrow-right"></i>
                  `}
                </button>
              </div>
            </div>
            
            <div class="text-center mt-6">
              <p class="text-slate-500 text-sm">
                <i class="fas fa-info-circle mr-1"></i>
                Contact your CHC sales rep if you need access
              </p>
            </div>
            
            <div class="flex justify-center gap-4 mt-8">
              <div class="flex items-center gap-2 text-slate-400 text-sm">
                <i class="fas fa-tags text-orange-500"></i>
                <span>312 Products</span>
              </div>
              <div class="flex items-center gap-2 text-slate-400 text-sm">
                <i class="fas fa-percent text-orange-500"></i>
                <span>Up to 50% Off</span>
              </div>
              <div class="flex items-center gap-2 text-slate-400 text-sm">
                <i class="fas fa-store text-orange-500"></i>
                <span>6 Locations</span>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderHeader() {
      return `
        <header class="bg-slate-900 text-white sticky top-0 z-40">
          <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-orange-500 rounded-lg flex items-center justify-center">
                  <i class="fas fa-box text-white"></i>
                </div>
                <div>
                  <h1 class="text-xl font-bold">CHC Paint</h1>
                  <p class="text-xs text-slate-400">Warehouse Sale 2026 • 312 Products</p>
                </div>
              </div>
              <button onclick="openCart()" class="relative bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
                <i class="fas fa-shopping-cart"></i>
                <span class="font-medium hidden sm:inline">Cart</span>
                ${getCartCount() > 0 ? `<span class="absolute -top-2 -right-2 bg-white text-orange-500 text-xs font-bold w-6 h-6 rounded-full flex items-center justify-center">${getCartCount()}</span>` : ''}
              </button>
            </div>
            <div class="mt-4 relative">
              <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
              <input type="text" id="searchInput" placeholder="Search by SKU or description..." value="${state.searchQuery}" 
                class="w-full pl-10 pr-4 py-3 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none">
            </div>
          </div>
          <div class="border-t border-slate-800 overflow-x-auto scrollbar-hide">
            <div class="max-w-7xl mx-auto px-4">
              <div class="flex gap-1 py-2">
                ${BRANDS.map(brand => `
                  <button onclick="setBrand('${brand}')" class="px-3 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-colors flex items-center gap-1 ${state.activeBrand === brand ? 'bg-orange-500 text-white' : 'text-slate-300 hover:bg-slate-800'}">
                    ${brand}
                    <span class="text-xs px-1.5 py-0.5 rounded ${state.activeBrand === brand ? 'bg-orange-600' : 'bg-slate-700'}">${PRODUCT_COUNTS[brand]}</span>
                  </button>
                `).join('')}
              </div>
            </div>
          </div>
        </header>
      `;
    }

    function renderMain() {
      const data = getFilteredProducts();
      const totalCount = getTotalFilteredCount();
      
      return `
        <main class="max-w-7xl mx-auto px-4 py-6">
          <div class="mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
            <div>
              <h2 class="text-2xl font-bold text-slate-900">${state.activeBrand}</h2>
              <p class="text-slate-500">Showing ${totalCount} products</p>
            </div>
            ${data.hasCategories ? renderCategoryNav(data.categories) : ''}
          </div>
          
          ${data.hasCategories ? renderCategorizedProducts(data.categories) : renderFlatProducts(data.products)}
        </main>
      `;
    }

    function renderCategoryNav(categories) {
      const categoryNames = Object.keys(categories);
      return `
        <div class="flex flex-wrap gap-2">
          ${categoryNames.map(cat => `
            <button onclick="scrollToCategory('cat-${cat.replace(/[^a-zA-Z0-9]/g, '-')}')" 
              class="px-3 py-1.5 bg-slate-100 hover:bg-slate-200 text-slate-700 text-sm rounded-full transition-colors">
              ${cat}
            </button>
          `).join('')}
        </div>
      `;
    }

    function renderCategorizedProducts(categories) {
      return Object.entries(categories).map(([category, products]) => `
        <div id="cat-${category.replace(/[^a-zA-Z0-9]/g, '-')}" class="mb-8">
          <div class="bg-gradient-to-r from-slate-800 to-slate-700 text-white px-4 py-3 rounded-t-xl flex items-center gap-3">
            <i class="fas fa-folder-open text-orange-400"></i>
            <h3 class="font-bold text-lg">${category}</h3>
            <span class="bg-orange-500 text-white text-xs px-2 py-0.5 rounded-full">${products.length} items</span>
          </div>
          <div class="bg-white rounded-b-xl shadow-sm overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-slate-50 border-b">
                  <tr>
                    <th class="text-left px-4 py-3 text-xs font-semibold text-slate-600 uppercase">SKU</th>
                    <th class="text-left px-4 py-3 text-xs font-semibold text-slate-600 uppercase">Description</th>
                    <th class="text-left px-4 py-3 text-xs font-semibold text-slate-600 uppercase">AE Price</th>
                    <th class="text-left px-4 py-3 text-xs font-semibold text-slate-600 uppercase">Sale Price</th>
                    <th class="text-right px-4 py-3 text-xs font-semibold text-slate-600 uppercase">Action</th>
                  </tr>
                </thead>
                <tbody class="divide-y">
                  ${products.map(p => renderProductRow(p)).join('')}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      `).join('');
    }

    function renderFlatProducts(products) {
      return `
        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-slate-50 border-b">
                <tr>
                  <th class="text-left px-4 py-3 text-xs font-semibold text-slate-600 uppercase">SKU</th>
                  <th class="text-left px-4 py-3 text-xs font-semibold text-slate-600 uppercase">Description</th>
                  <th class="text-left px-4 py-3 text-xs font-semibold text-slate-600 uppercase">AE Price</th>
                  <th class="text-left px-4 py-3 text-xs font-semibold text-slate-600 uppercase">Sale Price</th>
                  <th class="text-right px-4 py-3 text-xs font-semibold text-slate-600 uppercase">Action</th>
                </tr>
              </thead>
              <tbody class="divide-y">
                ${products.map(p => renderProductRow(p)).join('')}
              </tbody>
            </table>
          </div>
        </div>
      `;
    }

    function renderProductRow(product) {
      const inCart = state.cart.find(item => item.sku === product.sku);
      const discount = getDiscount(product.previousPrice, product.salePrice);
      const hasPromo = product.promo ? true : false;
      
      return `
        <tr class="hover:bg-slate-50 transition-colors ${hasPromo ? 'bg-green-50' : ''}">
          <td class="px-4 py-4">
            <span class="font-mono font-semibold text-blue-600">${product.sku}</span>
          </td>
          <td class="px-4 py-4">
            <p class="font-medium text-slate-900">${product.name}</p>
            ${hasPromo ? `<p class="text-xs mt-1 text-green-700 font-semibold"><i class="fas fa-gift mr-1"></i>${product.promo}</p>` : ''}
          </td>
          <td class="px-4 py-4">
            <span class="text-slate-400 line-through">$${formatPrice(product.previousPrice)}</span>
          </td>
          <td class="px-4 py-4">
            <div class="flex items-center gap-2 flex-wrap">
              <span class="text-lg font-bold text-green-600">$${formatPrice(product.salePrice)}</span>
              ${discount > 0 ? `<span class="px-2 py-0.5 bg-orange-100 text-orange-700 text-xs font-semibold rounded-full">${discount}% OFF</span>` : ''}
            </div>
          </td>
          <td class="px-4 py-4 text-right">
            ${inCart ? `
              <div class="inline-flex items-center gap-2 bg-slate-100 rounded-lg px-2 py-1">
                <button onclick="updateQuantity('${product.sku}', -1)" class="p-1 hover:bg-slate-200 rounded">
                  <i class="fas fa-minus text-sm"></i>
                </button>
                <span class="font-semibold w-8 text-center">${inCart.quantity}</span>
                <button onclick="updateQuantity('${product.sku}', 1)" class="p-1 hover:bg-slate-200 rounded">
                  <i class="fas fa-plus text-sm"></i>
                </button>
              </div>
            ` : `
              <button onclick='addToCart(${JSON.stringify(product).replace(/'/g, "&#39;")})' class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-medium inline-flex items-center gap-2 transition-colors">
                <i class="fas fa-plus"></i> Add
              </button>
            `}
          </td>
        </tr>
      `;
    }

    function renderCartSidebar() {
      return `
        <div class="fixed inset-0 z-50">
          <div class="absolute inset-0 bg-black/50" onclick="closeCart()"></div>
          <div class="absolute right-0 top-0 bottom-0 w-full max-w-md bg-white shadow-xl flex flex-col">
            <div class="p-4 border-b flex items-center justify-between bg-slate-900 text-white">
              <h2 class="text-lg font-bold flex items-center gap-2">
                <i class="fas fa-shopping-cart"></i>
                Your Cart (${getCartCount()})
              </h2>
              <button onclick="closeCart()" class="p-2 hover:bg-slate-800 rounded-lg">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="flex-1 overflow-auto p-4">
              ${state.cart.length === 0 ? `
                <div class="text-center py-12 text-slate-500">
                  <i class="fas fa-shopping-cart text-4xl opacity-30 mb-4"></i>
                  <p>Your cart is empty</p>
                  <p class="text-sm mt-1">Add products to get started</p>
                </div>
              ` : `
                <div class="space-y-3">
                  ${state.cart.map(item => `
                    <div class="bg-slate-50 rounded-lg p-3">
                      <div class="flex justify-between items-start mb-2">
                        <div class="flex-1 min-w-0">
                          <p class="font-mono text-sm text-blue-600">${item.sku}</p>
                          <p class="font-medium text-sm truncate">${item.name}</p>
                        </div>
                        <button onclick="removeFromCart('${item.sku}')" class="p-1 text-red-500 hover:bg-red-50 rounded ml-2">
                          <i class="fas fa-trash text-sm"></i>
                        </button>
                      </div>
                      <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2 bg-white rounded-lg px-2 py-1 border">
                          <button onclick="updateQuantity('${item.sku}', -1)" class="p-1 hover:bg-slate-100 rounded">
                            <i class="fas fa-minus text-xs"></i>
                          </button>
                          <span class="font-semibold w-6 text-center text-sm">${item.quantity}</span>
                          <button onclick="updateQuantity('${item.sku}', 1)" class="p-1 hover:bg-slate-100 rounded">
                            <i class="fas fa-plus text-xs"></i>
                          </button>
                        </div>
                        <p class="font-bold text-green-600">$${formatPrice(parseFloat(item.salePrice) * item.quantity)}</p>
                      </div>
                    </div>
                  `).join('')}
                </div>
              `}
            </div>
            ${state.cart.length > 0 ? `
              <div class="p-4 border-t bg-slate-50">
                <div class="flex justify-between items-center mb-4">
                  <span class="font-semibold text-lg">Total:</span>
                  <span class="font-bold text-2xl text-green-600">$${formatPrice(getCartTotal())}</span>
                </div>
                <button onclick="openCheckout()" class="w-full bg-orange-500 hover:bg-orange-600 text-white py-3 rounded-lg font-semibold transition-colors">
                  Proceed to Checkout
                </button>
              </div>
            ` : ''}
          </div>
        </div>
      `;
    }

    function renderCheckoutModal() {
      return `
        <div class="fixed inset-0 z-50 flex items-center justify-center p-4">
          <div class="absolute inset-0 bg-black/50" onclick="closeCheckout()"></div>
          <div class="relative bg-white rounded-xl shadow-2xl w-full max-w-lg">
            <div class="p-6 border-b">
              <h2 class="text-xl font-bold">Complete Your Order</h2>
              <p class="text-slate-500">Fill in your details to submit</p>
            </div>
            <div class="p-6 space-y-4">
              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Shop Name *</label>
                <input type="text" id="shopNameInput" value="${state.shopName}" placeholder="Your auto body shop name"
                  class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none">
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Contact Email *</label>
                <input type="email" id="emailInput" value="${state.contactEmail}" placeholder="your@email.com"
                  class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none">
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Deliver from Branch *</label>
                <div class="relative">
                  <select id="branchSelect" class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none appearance-none bg-white">
                    <option value="">Select a branch</option>
                    ${BRANCHES.map(b => `<option value="${b}" ${state.branch === b ? 'selected' : ''}>${b}</option>`).join('')}
                  </select>
                  <i class="fas fa-chevron-down absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none"></i>
                </div>
                <p class="text-xs text-slate-500 mt-1">
                  <i class="fas fa-truck mr-1"></i>
                  Your order will be processed by this branch
                </p>
              </div>
              <div class="bg-slate-50 rounded-lg p-4">
                <div class="flex justify-between items-center">
                  <span class="font-medium">Order Total:</span>
                  <span class="font-bold text-xl text-green-600">$${formatPrice(getCartTotal())}</span>
                </div>
                <p class="text-xs text-slate-500 mt-1">${getCartCount()} items</p>
              </div>
            </div>
            <div class="p-6 border-t bg-slate-50 flex gap-3 rounded-b-xl">
              <button onclick="closeCheckout()" class="flex-1 px-4 py-3 border border-slate-200 rounded-lg font-medium hover:bg-white transition-colors" ${state.isSubmitting ? 'disabled' : ''}>
                Cancel
              </button>
              <button onclick="handleSubmitOrder()" class="flex-1 px-4 py-3 bg-orange-500 hover:bg-orange-600 text-white rounded-lg font-semibold transition-colors flex items-center justify-center gap-2" ${state.isSubmitting ? 'disabled' : ''}>
                ${state.isSubmitting ? `
                  <i class="fas fa-spinner animate-spin"></i>
                  <span>Submitting...</span>
                ` : `
                  <span>Submit Order</span>
                `}
              </button>
            </div>
          </div>
        </div>
      `;
    }

    function renderOrderSuccess() {
      const branchEmail = BRANCH_EMAILS[state.branch];
      return `
        <div class="min-h-screen bg-green-50 flex items-center justify-center p-4">
          <div class="bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
              <i class="fas fa-check text-4xl text-green-600"></i>
            </div>
            <h1 class="text-2xl font-bold text-gray-900 mb-2">Order Submitted!</h1>
            <p class="text-gray-600 mb-6">Thank you for your order. Your order has been sent to the ${state.branch} branch.</p>
            <div class="bg-gray-50 rounded-lg p-4 mb-6 text-left">
              <p class="text-sm text-gray-500">Order ID</p>
              <p class="font-mono font-medium">${state.lastOrderId}</p>
              <p class="text-sm text-gray-500 mt-2">Shop Name</p>
              <p class="font-medium">${state.shopName}</p>
              <p class="text-sm text-gray-500 mt-2">Your Email</p>
              <p class="font-medium">${state.contactEmail}</p>
              <p class="text-sm text-gray-500 mt-2">Deliver from Branch</p>
              <p class="font-medium">${state.branch}</p>
              <p class="text-xs text-slate-400 mt-1">
                <i class="fas fa-envelope mr-1"></i>
                Order sent to: ${branchEmail}
              </p>
            </div>
            <button onclick="resetOrder()" class="w-full bg-orange-500 hover:bg-orange-600 text-white py-3 rounded-lg font-semibold transition-colors">
              Place Another Order
            </button>
          </div>
        </div>
      `;
    }

    function renderToast() {
      return `
        <div class="fixed bottom-4 right-4 bg-green-600 text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-2 z-50">
          <i class="fas fa-check"></i>
          <span>${state.toast}</span>
        </div>
      `;
    }

    function attachEventListeners() {
      const searchInput = document.getElementById('searchInput');
      if (searchInput) {
        searchInput.addEventListener('input', (e) => setSearch(e.target.value));
      }
    }

    function handleSubmitOrder() {
      const shopName = document.getElementById('shopNameInput')?.value || '';
      const email = document.getElementById('emailInput')?.value || '';
      const branch = document.getElementById('branchSelect')?.value || '';
      
      state.shopName = shopName;
      state.contactEmail = email;
      state.branch = branch;
      
      submitOrder();
    }

    // ========================================
    // INITIALIZE APP
    // ========================================
    render();
  </script>
</body>
</html>
